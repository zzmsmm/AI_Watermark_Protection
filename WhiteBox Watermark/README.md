## 基于白盒水印的深度学习 CV 模型版权认证流程
参考论文：https://arxiv.org/abs/2103.10021
### 概述

我们基于 PyTorch 和 Python 制定了针对深度学习中 CV 模型的白盒水印加注和版权认证规范，用户按照我们网站的规范，在本地训练自己的模型，将水印数据加注到事先训练好的深度学习模型中，并按照要求提交相关文件后，即可完成对其模型的版权认证。当用户面对侵权行为时，登录我们的网站并按要求提交相关文件后，我们的网站会根据后门数据对提交模型的侵权程度作出裁决，并为用户提供一个不具备法律效力的裁决结果。

### 水印加注算法与版权认证流程

1. 首先由我们的网站（即版权认证中心）根据用户的身份、提交的模型、提交的时间等信息为用户生成专用于该模型的二维码及其分类结果，用户从网站中自行下载，网站会将水印数据的散列值保存在数据库中。
2. 用户将二维码及其分类结果作为训练集对其 CV 模型进行再一次训练，同时也要训练一个额外的验证模块，验证模块以用户自己模型中比较重要的几层的输出值作为输入，以二维码的分类结果作为输出。建议以全连接层作为 Verify 模型的组成部分。用户在训练时可以通过参数的设置来尽可能地降低有水印模型和原始模型之间的差距，重点训练验证模块。
3. 用户将训练好的 Verify 模型及其类定义文件提交到网站中，一次模型版权认证完成。
4. 当用户遇到疑似侵权行为并能获取到对方的白盒权限时，用户需要将疑似侵权模型整理成可以直接与 Verify 模型对接的格式，并将整理好的模型及其类定义文件、版权认证时用到的水印数据上传到网站中，由网站执行前向传播，计算水印数据的分类精度。网站会对用户提交的水印数据计算散列值并和数据库中的记录进行对比，只有当两个散列值一致时，网站才会为用户执行裁决。
5. 网站将具备公信力的裁决结果提供给用户下载，该结果并不具备法律效力。

白盒水印算法的原理图如下：
![mtl](https://user-images.githubusercontent.com/72694643/168418071-8bcdb94e-1170-40a7-a321-eb43fd0daf8c.png)

### 文件提交规范与版权认证程序
#### 图像分类模型

CV_Classification_Standard 目录是对深度学习中图像分类模型进行白盒水印保护时用户提交文件制定的规范

我们以 cifar10 数据集和 ResNet 网络结构为例，对用户提交数据的格式进行了规定

每个文件的作用如下：

train.ipynb：利用数据集训练出分类模型 ResNet.pkl、神经网络中间层数据提取模型 ResNet_Extract.pkl 以及验证模型 ResNet_Verify.pkl，存放在 model 目录下

WhiteBoxVerify.py：用户使用版权认证中心分发的白盒水印数据 (存放在 data 目录下) 训练并添加完水印后，向中心提交的验证模型的类定义文件

WhiteBoxExtract.py：用户在获取到疑似侵权模型的白盒权限后，针对侵权模型在用户本地构建一个神经网络中间层提取模型，向中心提交的中间层提取模型的类定义文件

WhiteBoxTest.py：版权认证中心根据用户提交的 python 文件、疑似侵权模型、验证模块和用户的白盒水印数据，对模型的版权进行认证裁决


#### 目标检测模型
CV_ObjectDetection_Standard 目录是对深度学习中目标检测模型进行白盒水印保护时用户提交文件制定的规范

我们以 PennFudan 数据集和 FastRCNN 网络结构为例，对用户提交数据的格式进行了规定

每个文件的作用如下：

train.ipynb、coco_eval.py、coco_utils.py、engine.py、transforms.py、utils.py、ModelExtract.py：利用预训练的 maskrcnn_resnet50_fpn 模型在 PennFudan 数据集上训练出目标检测模型，其中 train.ipynb 用来训练模型并加注水印，ModelExtract.py 用来从疑似侵权模型中提取出中间层数据。运行 train.ipynb 和 ModelExtract.py 之后会生成四个模型文件，分别是 PennFudan_0.pkl（原始模型无水印）、PennFudan_wm.pkl（加注完水印的模型）、Extract.pkl（中间层数据提取模型）和 Verify（验证模块），存放在 model 目录下。

Verify.py：用户使用版权认证中心分发的白盒水印数据 (存放在 data 目录下) 训练并添加完水印后，向中心提交的验证模型的类定义文件，因为这里没有用到类定义，所以省去此文件

Extract.py：用户在获取到疑似侵权模型的白盒权限后，针对侵权模型在用户本地构建一个神经网络中间层提取模型，向中心提交的中间层提取模型的类定义文件

Test.py：版权认证中心根据用户提交的 python 文件、疑似侵权模型、验证模块和用户的白盒水印数据，对模型的版权进行认证裁决







